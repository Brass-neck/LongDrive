# nvm

```shell
nvm install 14.16.0    # 14.16.0是node版本号
nvm use 14.16.0
nvm uninstall 14.16.0
```

# 脚手架

```
npm init vite
选择 react + ts
```

# 添加其他依赖

- redux 是一种状态管理，vue、js、react 都可以用；react-redux 是对 redux 的封装，便于我们在 react 中更方便的使用 redux

- reset.css 去除浏览器原生样式。**注意 main.tsx 中引入 css 样式的顺序**
- sass `yarn add sass --dev`
- `yarn add antd` + `yarn add @ant-design/icons`
- 组件库的样式按需引入插件 `yarn add vite-plugin-style-import@1.4.1 --dev`
- 路由库 react-router-dom

# 启动命令

- --host 暴露 ip
- --port 指定端口
- --open 自动打开浏览器

```json
"scripts": {
  "dev": "vite --host --port 3002 --open",
  "build": "tsc && vite build",
  "preview": "vite preview"
}
```

# vite 配置

```js
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

import path from 'path' // 这里会报错，找不到模块“path”或其相应的类型声明；有node环境，所以实际上是可以找到的，这里是 ts 的报错，需要安装 node 这个库 的 ts声明配置
// yarn add @types/node --dev
// 低版本 vite 的第一个path也可能会报错，需要这样写 import * as path from 'path'

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src')
    }
  }
})
```

# 路由

### 路由的基本使用

1. 通过 Link、NavLink 进行跳转

```jsx
<Link to='/xxxx'>Demo</Link>
```

2. 注册路由

```jsx
<Routes>
    <Route path='/xxxx’ component={Demo}/>
</Routes>
```

3. <App />外层包裹路由组建

```js
import {BrowserRouter, HashRouter} from 'react-router-dom'
<BrowserRouter>
    <App />
</BrowserRouter>

<HashRouter>
    <App />
</HashRouter>
```

### 路由组建 vs 一般组件

1. 写法不同

```js
一般组件: <Demo />
路由组件: <Route path='/demo' component={Demo} />
```

2. 存放位置不同

   - 一般组件：components
   - 路由组件：pages

3. 接收到的 props 不同
   - 一般组件：写组件时传递了什么，就收到什么
   - 路由组件：接收 3 个固定属性
     - history
       - go、goBack、push、replace、goForward
     - location
       - state、search、pathname
     - match
       - params、path、url

### NavLink 封装

```js
<NavLink activeClassName="add" className="list-group-item" to="/home">Home</NavLink>
<NavLink activeClassName="add" className="list-group-item" to="/about">About</NavLink>

// 将固定的属性、active样式封装
import React, {Component} from 'react'
import {NavLink} from 'react-router-dom'

export default class MyNavLink extends Component {
  render(){
    return (
      <NavLink activeClassName="add" className="list-group-item" {...this.props} />
    )
  }
}

// 修改后的使用
<MyNavLink to="/home">Home</MyNavLink>
<MyNavLink to="/about">About</MyNavLink>
```

### 路由跳转

1. `<Link>`、`<NavLink>`
2. RouteComponentProps（路由组件） 中的 `this.props.history`
3. 编程式跳转，使用 `useNavigate` 钩子函数生成 `navigate` 函数，替代了老的 `useHistory`

   ```js
   import { useNavigate } from 'react-router-dom'
   function Foo() {
      const navigate = useNavigate()
      return (
        <div onClick={() => navigate('/home')}></div>
        <div onClick={() => navigate(-1)}></div>
       )
    }
   ```

4. `withRouter` 包裹一般组件，使其可以使用 `this.props.history`，withRouter 在 react-router 6 的版本被废弃了
5. window.open
6. 使用 `react-router-redux` 中的跳转方法
   ```js
   let param1 = {}
   dispatch(push("/path/newpath'", param1))
   dispatch(replace("/path/newpath'", param1))
   ```

### 解决多级路径刷新页面，样式丢失的问题

1. public/index.html 中引入样式时，使用绝对路径

```html
<link type="stylesheet" src="/css/index.css" />

<!-- 不要写成相对路径 -->
<link type="stylesheet" src="./css/index.css" />
```

2. public/index.html 中引入样式时，使用 %PUBLIC_URL%

```html
<link type="stylesheet" src="/%PUBLIC_URL%/css/index.css" />
```

3. 使用 HashRouter

> 刷新页面后，HashRouter 路由会导致 state 参数丢失；BrowserRouter 没有任何影响，因为 state 保存在 history 对象中

### 多层嵌套路由

react-router4 不再推荐将所有路由规则放在同一个地方集中式路由

- 子路由应该由父组件动态配置
- 组件在哪里匹配就在哪里渲染，更加灵活
- 任何组件中都可以使用 `Routes 组件`，且组件内的 Route path 默认需要**带上当前组件（父组件）的路径作为前缀**；并且父组件中需要使用 `Outlet` 展示子组件，这样保证子路由可以共享父路由的界面，父组件中可以为子组件占位，并最终渲染子组件

```js
// 这是在 Home 组件里，注册 Home 的两个子组件，所以需要携带 /home 父级路径
<Routes>
  <Route path='/home/news' component={News}></Route>
  <Route path='/home/about' component={About}></Route>
</Routes>
<Outlet></Outlet>
```

### 全匹配路由

可以匹配任何（非空）路径，该匹配拥有最低的优先级。可以用于设置 404 页面

```js
<Route path="*" element={<Error404 />}>
```

# 问题解答

1. 配置了 @ 别名，但是写 @ 时没有路径提示？

   - 配置 `tsconfig.json`中 `baseUrl: './'` 和 `paths: {'@/*': ['src/*'] }`
   - 配置根目录 `jsconfig.json`
   - vscode path 相关插件的 `settings.json` 的配置
